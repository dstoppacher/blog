---
layout: post
title:  "Disk ICs"
date:   2020-08-20
categories:
---

Here are my notes at setting up a disk made of self-gravitating particles, stable within a background NFW potential.

I'll be following the disk model from <a href="https://ui.adsabs.harvard.edu/abs/1993ApJS...86..389H/abstract"> Hernquist 1993</a>, since his method is pretty simple.


## Positions

The positions are selected from sampling the density profile:

$$\rho_(R,z) = \dfrac{M_d}{4 \pi h^2 z_0} \exp(-R/h) \sech^2 \left(\dfrac{z}{z_0} \right)$$


### Radius

The probability that a particle is within radius $$R$$ is given by

$$P(<R) = \dfrac{\int_{-\infty^\infty} \int 0^R \rho R' dR' dz'}{\int_{0^\infty} \int 0^\infty \rho R' dR' dz'}$$

This simplifies nicely for the given disk model to $$P(<R) = 1-exp(-R/h)$$.

Therefore, I selected a random number, $$A$$ between 0 and 1 for each particle, and solved for the radius, $$R = -h \ln (1-A)$$.

### Height

The probability it will be at height $$z$$ is:

$$P(<z) = \dfrac{2 \pi \int_{-\infty^z} \int 0^\infity \rho R' dR' dz'}{2 \pi \int_{-\infty^\infty} \int 0^\infty \rho R' dR' dz'}$$

For our model, $$P(<z) = (\tanh(z/z_0)+1)/2$$, so given a random number $$A$$ between 0 and 1 for each particle, the height is, $$z = z_0 \arctanh (2A -1)$$.

### Cartesian positions

To convert the radial position, $$R$$, to cartesian coordinates $$x$$, $$y$$, for each particle I randomly selected an angle $$\theta$$ between $$0$$ and $$2 \pi$$, and then solved $$x=R \cos(\theta)$$, $$y = R \sin(\theta)$$.



## Velocities

I did my best to follow Hernquist here, though there were a couple points I wasn't entirely clear on. For the most part, I assumed all the particles were located at $$z=0$$, so these approximations are probably only valid for a very thin disk.

I also found <a href="https://www.astro.rug.nl/~ahelmi/teaching/galaxies_course/2007/class_VI.pdf">these notes</a> helpful.  

### Tangential velocity

The velocity in $$v_z$$ was drawn from a Gaussian with a dispersion of $$\sqrt(\bar{v_z^2})$$.

The dispersion was calculated for an isothermal sheet"

$$\bar{v_z^2} = \pi G \Sigma(R) z_0$$,

I assumed that $$\Sigma(R)$$ is the total surface density, $$\Sigma(R) = \int \rho {\rm d}z$$:

$$\Sigma(R) = \dfrac{M_d}{2 \pi h^2} \exp(-R/h)$$


### Radial velocity

The radial velocity was also calculated by drawing from a Gaussian. In this case, they set the velocity dispersion to:

$$\bar{v_R^2} \simto Q \sigma_{R, {\rm crit}}(R_{\rm ref}) \exp(-R/h)$$

Where $$\sigma_{R, {\rm crit}}(R) = \dfrac{3.36 G \Sigma (R)}{\kappa(R)}$$ is the critical radial dispersion for axisymmetric stability. This is evaluated at $$R_{\rm ref}$$, which is a reference point in the disk corresponding to $$Q$$, the Toomre parameter specified at that radius. $$R_{\rm ref}$$ is typically $$2$$-$$3h$$.

$$\kappa^2 = \dfrac{3}{R}{\partial \Phi}{\partial R } + {\partial^2 \Phi}{\partial R^2} $$ is the epicyclic frequency  (note that the potential here should be from ALL contributions). In the case we are only considering the disk, but later we can add in the potential of the halo.

For an axisymmetric disk, the potential should follow:

$$\dfrac{\partial^2 \Phi}{\partial z^2} + \dfrac{1}{R}\dfrac{\partial}{\partial R} \left( R \dfrac{\partial \Phi}{\partial R}\right)= 4 \pi G \rho$$

There are methods in Binney and Tremaine for how to approximate this, or I could solve the PDE numerically.

Instead, I am going to use equation 2.191 in Binney and Tremaine (first edition):

$$\Phi(R,\phi) = - G {\rm d}R' R' \int_0^\infity {\rm d}R' \int0^{2 \pi} {{\rm d}\phi'}$$

Since the system is axisymmetric, I will just set $$\phi$$ to zero, and then solve the equation numerically.

The resulting potential is (3 panel plot with phi,dphidR, dphi2dR2)

and kappa is...





### Azimuthal Velocity

The azimuthal velocity,  $$v_{\phi}$$,  can be broken into to parts: first, there is the streaming component, and secondly, there is a random component.


First, the streaming component, \bar{v_\phi}, can be approximated as:

$$\bar{v_\phi}^2 - v_c^2 = \bar{v_R^2} \left(1 - \dfrac{\kappa^2}{4 \Omega ^2} - 2\dfrac{R}{h} \right)$$

Here,$$\Omega$$ is the angular frequency. This is solved from:
$$R \Omega^2 = \dfrac{{\rm d} \phi}{{\rm d}R}$$

$$v_c$$ is the circular velocity, which I calculated from $$M(<R) = 2 \pi \int_0^R \Sigma(R')R' dR'$$:
$$v_c^2 = \dfrac{G M_d}{ R} (1 - (R/h +1) \exp(-R/h))$$

Secondly, the random component is selected from a Gaussian with dispersion $$\sigma_\phi^2$$.
$$\sigma_\phi^2 = \bar{v_R^2} \dfrac{\kappa^2}{4 \Omega^2}$$.


Finally, $$v_{\phi}$$ is assigned as by adding the random component to $$\bar{v_\phi}$$. Note that sometimes these approximations break down at small radii. If this is a problem, we can "soften" $$\bar{v_R^2}$$ (see Equation 2.29 in Hernquist 1993). For now I'm ignoring this potential problem.

You can see that changing the Toomre parameter will change the radial dispersion, which in term will change the azimuthal velocity, and control the rotation of the disk.


### Cartesian Velocities

To convert $$(v_R, v_{\phi})$$... note that the radial velocity is $$\dot{r}$$ and the azimuthal derivative is $$r\dot{\phi}$$... Take derivatives of $$x(r,\phi)$$ and $$y(r,\phi)$$ to find:

$$v_x = v_{r} \cos(\theta) - v_{\phi} R \sin(\theta)$$

$$v_y = v_{r} \sin(\theta) + v_{\phi} R \cos(\theta)$$


## Stability of Isolated Disk

**STILL TROUBLESHOOTING**

To test this, I evolved the disk particles in isolation (no background potential)..

Parameters

Softening

SIMULATE AND PLOT...


## Adding in Halo Potential

Next I'm going to add in the halo potential, which will change the assigned velocities. Then I'll add in the potential for the gas in the disk.
